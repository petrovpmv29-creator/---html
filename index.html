<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#5fa3d0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Д-р Петров">
    <meta name="description" content="Техники самопомощи от психотерапевта">
    
    <title>Доктор Петров - Техники самопомощи</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        @font-face {
            font-family: 'Manrope';
            src: url('Manrope-Regular.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Manrope';
            src: url('Manrope-Bold.woff2') format('woff2');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #5fa3d0 0%, #7bc4dd 25%, #87ceeb 50%, #a8dff0 75%, #b8e6f5 100%);
            background-size: 400% 400%;
            animation: oceanGradient 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        @keyframes oceanGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(72, 209, 204, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(135, 206, 235, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.3s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }

        .logo {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(72, 209, 204, 0.25));
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(72, 209, 204, 0.35);
            animation: float 3s ease-in-out infinite;
            overflow: hidden;
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .main-title {
            font-size: 32px;
            font-weight: 200;
            letter-spacing: 3px;
            margin-bottom: 8px;
            text-transform: uppercase;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.95;
            letter-spacing: 2px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .menu-button {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.92));
            border: 2px solid rgba(72, 209, 204, 0.4);
            border-radius: 25px;
            padding: 18px 30px;
            margin: 10px 0;
            width: 100%;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
        }

        .menu-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(72, 209, 204, 0.3);
        }
        
        .menu-button:active {
            transform: scale(0.98);
        }

        .menu-button-title {
            font-size: 18px;
            color: #2E8B9E;
            letter-spacing: 3px;
            margin-bottom: 5px;
            display: block;
            font-weight: 600;
        }

        .menu-button-subtitle {
            font-size: 12px;
            color: #5FA3D0;
            letter-spacing: 1px;
        }

        .menu-button.special {
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.9), rgba(50, 50, 50, 0.85));
            border: 2px solid rgba(255, 107, 107, 0.4);
        }

        .menu-button.special .menu-button-title {
            color: #FF6B6B;
        }

        .menu-button.special .menu-button-subtitle {
            color: rgba(255, 255, 255, 0.7);
        }

        .back-button {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 10px 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateX(-3px);
        }
        
        .back-button:active {
            transform: scale(0.98);
        }

        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e90ff, #00bfff, #87ceeb, #48d1cc);
            background-size: 200% 200%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 
                0 0 30px rgba(30, 144, 255, 0.6),
                0 0 60px rgba(72, 209, 204, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
            border: 3px solid rgba(255, 255, 255, 0.6);
            margin: 40px auto;
            animation: gradientRotate 8s ease infinite;
        }
        
        @keyframes gradientRotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .breathing-circle.inhale {
            animation: inhaleAnimation 4s ease-in-out, gradientRotate 8s ease infinite;
        }
        
        .breathing-circle.hold {
            animation: holdAnimation 7s ease-in-out, gradientRotate 8s ease infinite;
        }
        
        .breathing-circle.exhale {
            animation: exhaleAnimation 8s ease-in-out, gradientRotate 8s ease infinite;
        }
        
        @keyframes inhaleAnimation {
            0% { transform: scale(1); }
            100% { transform: scale(1.25); }
        }
        
        @keyframes holdAnimation {
            0%, 100% { transform: scale(1.25); }
        }
        
        @keyframes exhaleAnimation {
            0% { transform: scale(1.25); }
            100% { transform: scale(0.85); }
        }

        .phase-text {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .phase-subtext {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 10px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
        }

        .countdown {
            font-size: 48px;
            font-weight: bold;
            text-shadow: 0 3px 15px rgba(0, 0, 0, 0.4);
        }

        .control-button {
            background: linear-gradient(135deg, #2E8B9E, #48D1CC);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 25px;
            padding: 14px 30px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 10px auto;
            display: block;
            box-shadow: 0 4px 15px rgba(72, 209, 204, 0.3);
            transition: all 0.3s ease;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 209, 204, 0.4);
        }
        
        .control-button:active {
            transform: scale(0.98);
        }

        .control-button.stop {
            background: rgba(255, 255, 255, 0.2);
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            gap: 10px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.3));
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            text-align: center;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 15px rgba(72, 209, 204, 0.25);
        }

        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
        }

        .card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.92));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12);
            border: 2px solid rgba(72, 209, 204, 0.3);
        }

        .card-title {
            font-size: 18px;
            color: #1e5f7a;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .card-description {
            font-size: 14px;
            color: #555;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .card-button {
            background: none;
            border: none;
            color: #2E8B9E;
            font-weight: bold;
            cursor: pointer;
            font-size: 15px;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .card-button:hover {
            color: #48D1CC;
        }
        
        .card-button:active {
            transform: scale(0.95);
        }

        .page-title {
            font-size: 32px;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }

        .page-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .advice-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.92));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            border: 3px solid rgba(255, 107, 107, 0.5);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.25);
        }

        .advice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 0, 0, 0.1);
        }

        .advice-number {
            font-size: 16px;
            font-weight: bold;
            color: #FF6B6B;
            letter-spacing: 1px;
        }

        .today-badge {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            padding: 4px 12px;
            border-radius: 12px;
            color: white;
            font-size: 11px;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .advice-text {
            font-size: 16px;
            line-height: 1.8;
            color: #333;
            white-space: pre-line;
        }

        .grounding-card {
            background: linear-gradient(135deg, #2a5298, #3d7ea6);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(42, 82, 152, 0.3);
            border: 2px solid rgba(72, 209, 204, 0.3);
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .grounding-card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px 0;
        }
        
        .grounding-step-number {
            font-size: 80px;
            font-weight: bold;
            background: linear-gradient(135deg, #48D1CC, #87CEEB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        
        .grounding-step-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #5FA3D0;
        }
        
        .grounding-step-description {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .grounding-step-example {
            font-size: 15px;
            color: #B0B0B0;
            font-style: italic;
        }
        
        .grounding-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid rgba(72, 209, 204, 0.3);
        }
        
        .grounding-nav-button {
            background: rgba(72, 209, 204, 0.2);
            border: 2px solid rgba(72, 209, 204, 0.5);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .grounding-nav-button:hover {
            background: rgba(72, 209, 204, 0.4);
            transform: scale(1.1);
        }
        
        .grounding-nav-button:active {
            transform: scale(0.95);
        }
        
        .grounding-nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .grounding-progress {
            font-size: 18px;
            font-weight: bold;
            background: rgba(72, 209, 204, 0.2);
            padding: 8px 20px;
            border-radius: 20px;
            border: 2px solid rgba(72, 209, 204, 0.4);
        }
        
        .grounding-intro-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .grounding-intro-subtitle {
            font-size: 16px;
            color: #B0B0B0;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .start-grounding-button {
            background: linear-gradient(135deg, #48D1CC, #5FA3D0);
            border: 2px solid white;
            border-radius: 25px;
            padding: 15px 40px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(72, 209, 204, 0.3);
            transition: all 0.3s ease;
        }
        
        .start-grounding-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 209, 204, 0.4);
        }
        
        .start-grounding-button:active {
            transform: scale(0.98);
        }

        .install-prompt {
            background: linear-gradient(135deg, rgba(72, 209, 204, 0.95), rgba(46, 139, 158, 0.95));
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(72, 209, 204, 0.3);
            display: none;
            align-items: center;
            gap: 15px;
        }
        
        .install-prompt.show {
            display: flex;
        }
        
        .install-prompt-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .install-prompt-button {
            background: white;
            color: #2E8B9E;
            border: none;
            border-radius: 12px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .install-prompt-button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Главное меню -->
        <div id="mainMenu" class="screen active">
            <div class="header">
                <div class="logo">
                    <img src="logo.png" alt="Логотип" onerror="this.parentElement.innerHTML='🧘'">
                </div>
                <h1 class="main-title">д-р Петров</h1>
                <p class="subtitle">врач-психотерапевт</p>
            </div>
            
            <!-- Подсказка установки PWA -->
            <div id="installPrompt" class="install-prompt">
                <div class="install-prompt-text">
                    Установите приложение для быстрого доступа
                </div>
                <button class="install-prompt-button" onclick="installPWA()">Установить</button>
            </div>
            
            <button class="menu-button" onclick="showScreen('breathingMenu')">
                <span class="menu-button-title">ДЫШУ</span>
                <span class="menu-button-subtitle">техники дыхания</span>
            </button>
            
            <button class="menu-button" onclick="showScreen('meditationMenu')">
                <span class="menu-button-title">МЕДИТИРУЮ</span>
                <span class="menu-button-subtitle">практики осознанности</span>
            </button>
            
            <button class="menu-button" onclick="showScreen('relaxationMenu')">
                <span class="menu-button-title">ОТПУСКАЮ</span>
                <span class="menu-button-subtitle">снятие напряжения</span>
            </button>
            
            <button class="menu-button" onclick="showScreen('grounding')">
                <span class="menu-button-title">НЕ ПАНИКУЮ</span>
                <span class="menu-button-subtitle">техника заземления</span>
            </button>
            
            <button class="menu-button special" onclick="showScreen('advice')">
                <span class="menu-button-title">ВРЕДНЫЕ СОВЕТЫ</span>
                <span class="menu-button-subtitle">от психотерапевта</span>
            </button>
        </div>

        <!-- Меню дыхания -->
        <div id="breathingMenu" class="screen">
            <button class="back-button" onclick="showScreen('mainMenu')">← Главное меню</button>
            
            <h2 class="page-title">Техники дыхания</h2>
            <p class="page-subtitle">Выберите подходящую практику</p>
            
            <div class="card">
                <div class="card-title">🌬️ Дыхание 4-7-8</div>
                <div class="card-description">
                    Классическая техника для снятия стресса и засыпания.<br><br>
                    • Вдох через нос 4 секунды<br>
                    • Задержка дыхания 7 секунд<br>
                    • Выдох через рот 8 секунд
                </div>
                <button class="card-button" onclick="showScreen('breathing478')">НАЧАТЬ →</button>
            </div>
            
            <div class="card">
                <div class="card-title">💪 Дыхание 4-8-12</div>
                <div class="card-description">
                    Усиленная версия для глубокой релаксации.<br><br>
                    • Вдох через нос 4 секунды<br>
                    • Задержка дыхания 8 секунд<br>
                    • Выдох через рот 12 секунд
                </div>
                <button class="card-button" onclick="showScreen('breathing4812')">НАЧАТЬ →</button>
            </div>
        </div>

        <!-- Дыхание 4-7-8 -->
        <div id="breathing478" class="screen">
            <button class="back-button" onclick="showScreen('breathingMenu')">← Назад</button>
            
            <h2 class="page-title">Дыхание 4-7-8</h2>
            <p class="page-subtitle">Для снятия стресса и тревоги</p>
            
            <div class="breathing-circle" id="breathingCircle478">
                <div class="phase-text">Готовность</div>
                <div class="phase-subtext">начните когда готовы</div>
                <div class="countdown">—</div>
            </div>
            
            <button id="startBtn478" class="control-button" onclick="startBreathing478()">НАЧАТЬ ДЫШАТЬ</button>
            <button id="stopBtn478" class="control-button stop" style="display:none" onclick="stopBreathing()">ОСТАНОВИТЬ</button>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Циклов</div>
                    <div id="cycles478" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Время</div>
                    <div id="time478" class="stat-value">0:00</div>
                </div>
            </div>
        </div>

        <!-- Дыхание 4-8-12 -->
        <div id="breathing4812" class="screen">
            <button class="back-button" onclick="showScreen('breathingMenu')">← Назад</button>
            
            <h2 class="page-title">Дыхание 4-8-12</h2>
            <p class="page-subtitle">Усиленная версия</p>
            
            <div class="breathing-circle" id="breathingCircle4812">
                <div class="phase-text">Готовность</div>
                <div class="phase-subtext">начните когда готовы</div>
                <div class="countdown">—</div>
            </div>
            
            <button id="startBtn4812" class="control-button" onclick="startBreathing4812()">НАЧАТЬ ДЫШАТЬ</button>
            <button id="stopBtn4812" class="control-button stop" style="display:none" onclick="stopBreathing()">ОСТАНОВИТЬ</button>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Циклов</div>
                    <div id="cycles4812" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Время</div>
                    <div id="time4812" class="stat-value">0:00</div>
                </div>
            </div>
        </div>

        <!-- Меню медитации -->
        <div id="meditationMenu" class="screen">
            <button class="back-button" onclick="showScreen('mainMenu')">← Главное меню</button>
            
            <h2 class="page-title">Медитации</h2>
            <p class="page-subtitle">Практики осознанности</p>
            
            <div class="card">
                <div class="card-title">🧘 Сосредоточение на дыхании</div>
                <div class="card-description">Базовая практика mindfulness. Наблюдайте за естественным дыханием без изменений.</div>
                <button class="card-button" onclick="startMeditation('breathing', 5)">НАЧАТЬ (5 минут) →</button>
            </div>
            
            <div class="card">
                <div class="card-title">🌊 Сканирование тела</div>
                <div class="card-description">Последовательное осознавание всех частей тела от головы до пальцев ног.</div>
                <button class="card-button" onclick="startMeditation('bodyscan', 10)">НАЧАТЬ (10 минут) →</button>
            </div>
            
            <div class="card">
                <div class="card-title">💜 Любящая доброта</div>
                <div class="card-description">Практика культивирования доброжелательности к себе и другим.</div>
                <button class="card-button" onclick="startMeditation('lovingkindness', 7)">НАЧАТЬ (7 минут) →</button>
            </div>
        </div>

        <!-- Экран медитации -->
        <div id="meditationScreen" class="screen">
            <button class="back-button" onclick="stopMeditation()">← Завершить</button>
            
            <h2 id="meditationTitle" class="page-title">Медитация</h2>
            <p style="text-align: center; color: rgba(255,255,255,0.7); font-size: 12px; margin-bottom: 20px;">подсказки меняются каждые 30 секунд</p>
            
            <div class="breathing-circle" style="background: linear-gradient(135deg, #9C27B0, #BA68C8, #CE93D8, #E1BEE7);">
                <div class="phase-text" id="meditationTimer">5:00</div>
                <div class="phase-subtext">осталось</div>
            </div>
            
            <div class="card">
                <div class="card-description" id="meditationPrompt" style="text-align: center; margin: 0;">
                    Устройтесь удобно. Закройте глаза или смягчите взгляд...
                </div>
            </div>
            
            <button id="pauseBtn" class="control-button" onclick="togglePause()" style="background: #FFA500;">ПАУЗА</button>
            <button class="control-button stop" onclick="stopMeditation()">ЗАВЕРШИТЬ</button>
        </div>

        <!-- Меню релаксации -->
        <div id="relaxationMenu" class="screen">
            <button class="back-button" onclick="showScreen('mainMenu')">← Главное меню</button>
            
            <h2 class="page-title">Релаксация</h2>
            <p class="page-subtitle">Снятие напряжения</p>
            
            <div class="card">
                <div class="card-title">💪 Прогрессивная мышечная релаксация</div>
                <div class="card-description">Последовательное напряжение и расслабление групп мышц для глубокого отдыха.</div>
                <button class="card-button" onclick="startRelaxation('pmr', 15)">НАЧАТЬ (15 минут) →</button>
            </div>
            
            <div class="card">
                <div class="card-title">🏝️ Визуализация</div>
                <div class="card-description">Мысленное путешествие в спокойное и безопасное место.</div>
                <button class="card-button" onclick="startRelaxation('visualization', 10)">НАЧАТЬ (10 минут) →</button>
            </div>
            
            <div class="card">
                <div class="card-title">🎯 Быстрое снятие напряжения</div>
                <div class="card-description">Короткие упражнения для разных зон тела в течение дня.</div>
                <button class="card-button" onclick="startRelaxation('quickrelax', 5)">НАЧАТЬ (5 минут) →</button>
            </div>
        </div>

        <!-- Экран релаксации -->
        <div id="relaxationScreen" class="screen">
            <button class="back-button" onclick="stopRelaxation()">← Завершить</button>
            
            <h2 id="relaxationTitle" class="page-title">Релаксация</h2>
            <p style="text-align: center; color: rgba(255,255,255,0.7); font-size: 12px; margin-bottom: 20px;">подсказки меняются каждые 30 секунд</p>
            
            <div class="breathing-circle" style="background: linear-gradient(135deg, #FF6B9D, #FF8CAD, #FFB3C6, #FFCCD9);">
                <div class="phase-text" id="relaxationTimer">10:00</div>
                <div class="phase-subtext">осталось</div>
            </div>
            
            <div class="card">
                <div class="card-description" id="relaxationPrompt" style="text-align: center; margin: 0;">
                    Устройтесь удобно...
                </div>
            </div>
            
            <button id="pauseBtnRelax" class="control-button" onclick="togglePauseRelax()" style="background: #FFA500;">ПАУЗА</button>
            <button class="control-button stop" onclick="stopRelaxation()">ЗАВЕРШИТЬ</button>
        </div>

        <!-- Заземление -->
        <div id="grounding" class="screen">
            <button class="back-button" onclick="showScreen('mainMenu')">← Главное меню</button>
            
            <h2 class="page-title">НЕ ПАНИКУЮ</h2>
            
            <div class="grounding-card" id="groundingCard"></div>
        </div>

        <!-- Вредные советы -->
        <div id="advice" class="screen">
            <button class="back-button" onclick="showScreen('mainMenu')">← Главное меню</button>
            
            <h2 class="page-title">Вредные советы</h2>
            <p class="page-subtitle">от психотерапевта на каждый день</p>
            
            <div class="advice-card">
                <div class="advice-header">
                    <div id="adviceNumber" class="advice-number">#1247</div>
                    <div id="todayBadge" class="today-badge">СЕГОДНЯ</div>
                </div>
                <div id="adviceText" class="advice-text"></div>
            </div>
            
            <div class="card">
                <p style="text-align: center; color: #666; font-size: 14px; line-height: 1.5;">
                    Ирония: Эти советы показывают, чего НЕ надо делать. 
                    Если узнали себя — самое время что-то менять.
                </p>
            </div>
        </div>
    </div>

    <script>
        const advices = [
            { id: 1247, text: 'Если чувствуешь тревогу,\nСразу думай о плохом —\nПредставляй катастрофы ярче,\nЧтобы страх совсем добить.' },
            { id: 3892, text: 'Никогда не спи достаточно,\nЛучше скролль до пяти утра.\nСон — для слабых, настоящий невротик\nДолжен быть всегда без сил.' },
            { id: 5614, text: 'Обязательно сравнивай\nСебя с людьми из инстаграма.\nИх успехи — твои провалы,\nНе забудь об этом ни на миг.' },
            { id: 7283, text: 'Копи обиды как сокровища,\nВспоминай их каждый вечер.\nЧто сказал сосед в девяностом —\nЭто важно не забыть.' },
            { id: 2156, text: 'Если злишься — держи в себе,\nУлыбайся через силу.\nПусть внутри всё закипает —\nЭто очень хорошо для язвы.' },
            { id: 9407, text: 'Планируй жизнь на сорок лет вперёд,\nРасписание по минутам.\nСпонтанность — признак незрелости,\nКонтроль важнее радости.' },
            { id: 4721, text: 'Говори всегда «я в порядке»,\nДаже если это ложь.\nЧувства прятать — вот искусство,\nМаска — лучший твой наряд.' },
            { id: 8135, text: 'Принимай всё близко к сердцу,\nКаждый взгляд и каждый жест.\nНаверняка все против тебя,\nПаранойя — друг надёжный.' },
            { id: 6549, text: 'Никогда не проси помощи,\nСправляйся всегда сам.\nНезависимость — это когда\nТонешь молча и с достоинством.' },
            { id: 3208, text: 'Жалей себя почаще,\nЭто очень продуктивно.\nВместо действий — сто причин,\nПочему тебе так плохо.' },
            { id: 1583, text: 'Откладывай важные дела\nДо последнего момента.\nСтресс дедлайна так полезен\nДля нервной системы.' },
            { id: 4926, text: 'Ешь эмоции шоколадом,\nЗапивай тоску вином.\nЧувства можно заглушить —\nГлавное, найти чем именно.' },
            { id: 7641, text: 'Требуй от себя совершенства\nВ каждой мелочи всегда.\nОшибки — это катастрофа,\nПрощать себя нельзя.' },
            { id: 2394, text: 'Читай все новости подряд,\nОсобенно негативные.\nЧем больше ужасов узнаешь,\nТем лучше спать ночами.' },
            { id: 5817, text: 'Отношения строй с теми,\nКто тебя не ценит.\nМожет, если постараешься,\nОни тебя полюбят.' },
            { id: 9152, text: 'Границы — это эгоизм,\nГовори всем только «да».\nВыгорание профессиональное —\nЗнак того, что ты хороший.' },
            { id: 3467, text: 'Прошлое перебирай почаще,\nДумай, что бы изменил.\nСожаления — отличное хобби,\nОсобенно в три часа ночи.' },
            { id: 6780, text: 'Диагнозы ставь себе по гуглу,\nСимптомы все запоминай.\nУ тебя наверняка\nВсё самое страшное сразу.' },
            { id: 8293, text: 'Конфликтов избегай любых,\nСоглашайся против воли.\nВнутренний протест копи,\nПассивная агрессия — твой стиль.' },
            { id: 1946, text: 'Живи только будущим,\nНастоящее не важно.\nКогда-нибудь потом начнёшь\nРадоваться и быть счастливым.' },
            { id: 5234, text: 'Чувства анализируй до дыр,\nПочему и отчего.\nПросто чувствовать — примитивно,\nНужно всё разобрать на части.' },
            { id: 7568, text: 'Советы раздавай всем подряд,\nДаже если не просили.\nТы же знаешь, как им жить,\nТвой опыт универсален.' },
            { id: 2801, text: 'Вини себя за всё на свете,\nЗа дождь и за войну.\nГиперответственность — признак\nЗрелой личности, конечно.' },
            { id: 4175, text: 'Медитируй по пять часов,\nЙогой мучай тело.\nДуховность — это когда больно,\nНо ты терпишь ради просветления.' },
            { id: 9423, text: 'Позитивным будь всегда,\nНегатив гони подальше.\nТоксичная позитивность —\nЛучше честных чувств.' },
            { id: 6847, text: 'Работай без выходных,\nОтпуск — признак лени.\nПрофессиональное выгорание —\nМедаль за трудолюбие.' },
            { id: 3529, text: 'Детские травмы не лечи,\nЭто всё придумки.\nПросто забудь и живи дальше,\nВытеснение решает всё.' },
            { id: 8061, text: 'В отношениях растворись полностью,\nСобственных желаний не имей.\nСозависимость романтична,\nГраницы убивают любовь.' },
            { id: 1794, text: 'Эмоции считай врагами,\nЛогика — единственный друг.\nЧувствовать — значит быть слабым,\nРобот — идеал человека.' },
            { id: 5382, text: 'И последний главный совет:\nВсё вышеперечисленное\nПрименяй в жизни активно,\nИ психотерапевт обеспечен работой.' }
        ];

        const groundingSteps = [
            { type: 'intro', title: 'Техника заземления 5-4-3-2-1', subtitle: 'Помогает быстро справиться с паникой и вернуться в "здесь и сейчас".\n\nДелайте медленно и вдумчиво. На каждый пункт тратьте 30-60 секунд.' },
            { number: '5', title: 'ПОСМОТРИТЕ', description: 'Назовите 5 вещей, которые вы видите вокруг себя', example: 'Например: окно, стол, телефон, дверь, лампа' },
            { number: '4', title: 'ПОТРОГАЙТЕ', description: 'Прикоснитесь к 4 разным поверхностям и ощутите их текстуру', example: 'Например: ткань одежды, край стола, волосы, телефон' },
            { number: '3', title: 'ПОСЛУШАЙТЕ', description: 'Назовите 3 звука, которые вы слышите прямо сейчас', example: 'Например: ваше дыхание, шум улицы, тиканье часов' },
            { number: '2', title: 'УЛОВИТЕ', description: 'Назовите 2 запаха, которые вы чувствуете', example: 'Например: кофе, свежий воздух, или запах одежды' },
            { number: '1', title: 'ПОЧУВСТВУЙТЕ', description: 'Сосредоточьтесь на 1 вкусе во рту', example: 'Например: мята, кофе или просто вкус слюны' },
            { type: 'outro', title: 'Отличная работа! 🌟', subtitle: 'Вы вернулись в настоящий момент.\n\nИспользуйте эту технику когда почувствуете:\n• Начало паники\n• Накручивание себя\n• Ощущение нереальности\n• Зацикливание на страхах' }
        ];

        let currentBreathingMode = null;
        let breathingInterval = null;
        let breathingTimeout = null;
        let cycles = 0;
        let totalTime = 0;
        let timeInterval = null;
        let currentGroundingStep = 0;
        let deferredPrompt = null;
        
        let meditationInterval = null;
        let meditationTimeLeft = 0;
        let currentMeditationType = null;
        let currentPromptIndex = 0;
        let isPaused = false;
        let promptInterval = null;
        
        let relaxationInterval = null;
        let relaxationTimeLeft = 0;
        let currentRelaxationType = null;
        let currentRelaxPromptIndex = 0;
        let isRelaxPaused = false;
        let relaxPromptInterval = null;

        const meditationData = {
            breathing: {
                title: 'Сосредоточение на дыхании',
                prompts: [
                    'Устройтесь удобно. Закройте глаза или смягчите взгляд.',
                    'Обратите внимание на своё дыхание. Не пытайтесь его изменить.',
                    'Просто наблюдайте, как воздух входит и выходит.',
                    'Когда заметите, что отвлеклись - мягко возвращайте внимание к дыханию.',
                    'Нет правильного или неправильного способа дышать.',
                    'Если мысли уводят вас - это нормально. Просто возвращайтесь к дыханию.',
                    'Почувствуйте движение воздуха в носу или животе.',
                    'Продолжайте спокойно наблюдать за дыханием.',
                    'Скоро практика завершится. Просто будьте здесь и сейчас.',
                    'Последние моменты. Поблагодарите себя за эту практику.'
                ]
            },
            bodyscan: {
                title: 'Сканирование тела',
                prompts: [
                    'Устройтесь удобно. Можно лечь или сесть.',
                    'Обратите внимание на макушку головы. Какие там ощущения?',
                    'Переместите внимание на лоб. Расслабьте все мышцы.',
                    'Почувствуйте глаза, щёки, челюсть. Отпустите напряжение.',
                    'Осознайте область рта и губ. Позвольте языку расслабиться.',
                    'Осознайте шею и плечи. Позвольте им расслабиться.',
                    'Обратите внимание на правую руку от плеча до кончиков пальцев.',
                    'Теперь левую руку - от плеча до кончиков пальцев.',
                    'Почувствуйте обе руки одновременно. Они расслаблены и тяжёлые.',
                    'Почувствуйте грудь и живот. Дыхание движет вашим телом.',
                    'Осознайте всю спину, от лопаток до поясницы.',
                    'Обратите внимание на таз, ягодицы. Отпустите напряжение.',
                    'Почувствуйте правую ногу - бедро, колено, голень, стопу.',
                    'Теперь левую ногу - от бедра до стопы.',
                    'Почувствуйте обе ноги. Они расслаблены.',
                    'Почувствуйте стопы и пальцы ног. Осознайте всё тело целиком.',
                    'Ваше тело полностью расслаблено. Просто наблюдайте.',
                    'Останьтесь в этом спокойном состоянии.',
                    'Медленно начните двигать пальцами рук и ног.',
                    'Когда будете готовы, мягко откройте глаза.'
                ]
            },
            lovingkindness: {
                title: 'Любящая доброта',
                prompts: [
                    'Устройтесь удобно. Положите руку на сердце.',
                    'Подумайте о себе с добротой. Вы достойны заботы.',
                    'Про себя скажите: "Пусть я буду счастлив"',
                    '"Пусть я буду здоров"',
                    '"Пусть я буду в безопасности"',
                    '"Пусть я живу с лёгкостью"',
                    'Почувствуйте эти пожелания для себя. Вы их заслуживаете.',
                    'Теперь подумайте о близком человеке, которого любите.',
                    'Представьте его образ. Почувствуйте тепло к нему.',
                    'Пожелайте ему: "Пусть ты будешь счастлив"',
                    '"Пусть ты будешь здоров и в безопасности"',
                    'Расширьте это чувство на всех близких людей вокруг.',
                    'Теперь на всех людей - знакомых и незнакомых.',
                    'Пожелайте благополучия всем живым существам.',
                    'Почувствуйте тепло в области сердца. Это чувство любящей доброты.',
                    'Побудьте с этим чувством. Оно всегда с вами.'
                ]
            }
        };

        const relaxationData = {
            pmr: {
                title: 'Прогрессивная мышечная релаксация',
                prompts: [
                    'Устройтесь удобно, лёжа или сидя. Дышите естественно.',
                    'Мы будем работать с разными группами мышц. Напрягайте на 5 секунд, затем расслабляйте.',
                    'Правая рука: Сожмите кулак на 5 секунд... Отпустите. Почувствуйте тепло.',
                    'Левая рука: Сожмите кулак... Расслабьте. Ощутите разницу.',
                    'Обе руки: Напрягите бицепсы, прижмите локти к телу... Расслабьте полностью.',
                    'Заметьте, как приятно расслабление после напряжения.',
                    'Лицо: Поднимите брови высоко вверх... Расслабьте лоб. Он становится гладким.',
                    'Глаза: Зажмурьтесь крепко... Отпустите. Веки тяжёлые.',
                    'Рот и челюсть: Сожмите зубы, напрегите челюсть... Расслабьте, приоткройте рот.',
                    'Всё лицо расслаблено. Чувствуете тепло и тяжесть?',
                    'Шея: Прижмите подбородок к груди... Отпустите напряжение.',
                    'Теперь откиньте голову назад... Верните в нейтральное положение.',
                    'Плечи: Поднимите плечи к ушам... Опустите их вниз. Они тяжёлые.',
                    'Повторите: плечи вверх... и вниз. Полностью расслабьте.',
                    'Грудь: Глубокий вдох, задержите дыхание... Медленный выдох, расслабьтесь.',
                    'Ещё раз глубоко вдохните... Выдохните всё напряжение.',
                    'Спина: Сведите лопатки вместе... Отпустите. Спина мягкая.',
                    'Прогните спину слегка... Расслабьте, вернитесь в удобное положение.',
                    'Живот: Втяните живот максимально... Расслабьте. Дышите свободно.',
                    'Напрягите пресс... Отпустите. Живот мягкий и расслабленный.',
                    'Ягодицы: Сожмите ягодицы... Отпустите полностью.',
                    'Бёдра: Напрягите мышцы бёдер... Расслабьте. Они становятся тяжёлыми.',
                    'Икры: Потяните носки на себя... Расслабьте ноги.',
                    'Теперь от себя... И снова расслабьте.',
                    'Стопы: Сожмите пальцы ног... Отпустите. Стопы расслаблены.',
                    'Разведите пальцы ног... Расслабьте.',
                    'Всё тело целиком: Напрегите всё сразу - руки, лицо, корпус, ноги...',
                    'И полностью расслабьтесь. Отпустите всё напряжение из тела.',
                    'Побудьте в этом состоянии глубокого расслабления. Наслаждайтесь покоем.',
                    'Медленно начните двигаться. Откройте глаза когда будете готовы.'
                ]
            },
            visualization: {
                title: 'Визуализация безопасного места',
                prompts: [
                    'Устройтесь удобно, закройте глаза. Дышите спокойно.',
                    'Представьте место, где вы чувствуете себя в полной безопасности.',
                    'Это может быть реальное место или вымышленное. Пляж, лес, горы, уютная комната.',
                    'Дайте образу проявиться. Не торопитесь.',
                    'Что вы видите? Начните с общей картины.',
                    'Рассмотрите цвета вокруг вас. Какие оттенки преобладают?',
                    'Заметьте свет - яркий солнечный или мягкий рассеянный?',
                    'Обратите внимание на тени и контрасты.',
                    'Какие формы и текстуры вас окружают?',
                    'Что вы слышите? Может быть, звуки природы?',
                    'Шум волн, пение птиц, шелест листьев, журчание воды...',
                    'Или это приятная тишина? Какие звуки наполняют ваше место?',
                    'Что вы чувствуете кожей? Температуру воздуха?',
                    'Тепло солнца на лице, прохладу ветра, влажность воздуха.',
                    'Какие поверхности под вашими руками? Мягкие, гладкие, тёплые?',
                    'Ощутите комфорт всем телом. Вы в полной безопасности здесь.',
                    'Что вы ощущаете носом? Какие запахи присутствуют?',
                    'Морской бриз, аромат хвои, свежесть травы, запах цветов...',
                    'Возможно, чувствуете вкус - морской соли, свежих фруктов, любимого напитка.',
                    'Побудьте в этом месте. Исследуйте его.',
                    'Запомните все ощущения. Это ваше безопасное убежище.',
                    'Вы всегда можете вернуться сюда мысленно, когда захотите.',
                    'Медленно начните осознавать своё физическое тело.',
                    'Когда будете готовы, мягко откройте глаза.'
                ]
            },
            quickrelax: {
                title: 'Быстрая релаксация',
                prompts: [
                    'Начнём с быстрых упражнений для снятия напряжения.',
                    'Лицо: Поднимите брови - расслабьте. Зажмурьтесь - откройте.',
                    'Надуйте щёки - выпустите воздух. Помассируйте виски круговыми движениями.',
                    'Шея: Поднимите плечи к ушам - опустите. Повторите 3 раза.',
                    'Медленные круговые движения плечами назад, затем вперёд.',
                    'Наклоны головы: вправо - влево. Повороты головы в стороны.',
                    'Руки: Сильно сожмите кулаки - разожмите. Растопырьте пальцы максимально.',
                    'Потрясите руками. Помассируйте запястья.',
                    'Дыхание: 3 глубоких вдоха-выдоха. Выдох в 2 раза длиннее вдоха.',
                    'Дыхание животом. Зевните несколько раз, даже специально.',
                    'Почувствуйте, как напряжение уходит из тела.',
                    'Вы расслаблены и спокойны. Можете вернуться к своим делам.'
                ]
            }
        };

        // PWA Install
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.add('show');
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA установлено');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').classList.remove('show');
                });
            }
        }

        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(() => {
                console.log('Service Worker зарегистрирован');
            }).catch(() => {
                console.log('Service Worker не поддерживается');
            });
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'advice') showDailyAdvice();
            if (screenId === 'grounding') initGrounding();
            if (screenId !== 'breathing478' && screenId !== 'breathing4812') stopBreathing();
            if (screenId !== 'meditationScreen') stopMeditation();
            if (screenId !== 'relaxationScreen') stopRelaxation();
        }

        function showDailyAdvice() {
            const today = new Date();
            const dayOfMonth = today.getDate();
            const index = (dayOfMonth - 1) % advices.length;
            const advice = advices[index];
            
            document.getElementById('adviceNumber').textContent = '#' + advice.id;
            document.getElementById('adviceText').textContent = advice.text;
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function triggerHaptic() {
            // Тактильная обратная связь (работает только на Android)
            if ('vibrate' in navigator) {
                navigator.vibrate(150);
            }
            // Альтернатива для iOS (не работает в Safari, но можно попробовать)
            if (window.Haptics) {
                window.Haptics.impact({ style: 'medium' });
            }
        }

        function startBreathing478() {
            if (currentBreathingMode) stopBreathing();
            currentBreathingMode = '478';
            cycles = 0;
            totalTime = 0;
            startBreathing(4, 7, 8);
            document.getElementById('startBtn478').style.display = 'none';
            document.getElementById('stopBtn478').style.display = 'block';
            
            timeInterval = setInterval(() => {
                totalTime++;
                document.getElementById('time478').textContent = formatTime(totalTime);
            }, 1000);
        }

        function startBreathing4812() {
            if (currentBreathingMode) stopBreathing();
            currentBreathingMode = '4812';
            cycles = 0;
            totalTime = 0;
            startBreathing(4, 8, 12);
            document.getElementById('startBtn4812').style.display = 'none';
            document.getElementById('stopBtn4812').style.display = 'block';
            
            timeInterval = setInterval(() => {
                totalTime++;
                document.getElementById('time4812').textContent = formatTime(totalTime);
            }, 1000);
        }

        function startBreathing(inhale, hold, exhale) {
            const circleId = currentBreathingMode === '478' ? 'breathingCircle478' : 'breathingCircle4812';
            const circle = document.getElementById(circleId);
            const cyclesId = currentBreathingMode === '478' ? 'cycles478' : 'cycles4812';
            const cyclesEl = document.getElementById(cyclesId);
            
            breathingCycle();
            
            function breathingCycle() {
                updateCircle(circle, 'Вдох', 'через нос', inhale);
                circle.classList.remove('hold', 'exhale');
                circle.classList.add('inhale');
                
                breathingTimeout = setTimeout(() => {
                    updateCircle(circle, 'Задержка', 'спокойно', hold);
                    circle.classList.remove('inhale', 'exhale');
                    circle.classList.add('hold');
                    
                    breathingTimeout = setTimeout(() => {
                        updateCircle(circle, 'Выдох', 'через рот', exhale);
                        circle.classList.remove('inhale', 'hold');
                        circle.classList.add('exhale');
                        
                        breathingTimeout = setTimeout(() => {
                            cycles++;
                            cyclesEl.textContent = cycles;
                            breathingCycle();
                        }, exhale * 1000);
                    }, hold * 1000);
                }, inhale * 1000);
            }
        }

        function updateCircle(circle, phase, subtext, duration) {
            if (!circle) return;
            
            const phaseText = circle.querySelector('.phase-text');
            const phaseSubtext = circle.querySelector('.phase-subtext');
            const countdown = circle.querySelector('.countdown');
            
            if (!phaseText || !phaseSubtext || !countdown) return;
            
            phaseText.textContent = phase;
            phaseSubtext.textContent = subtext;
            
            if (phase !== 'Готовность') {
                triggerHaptic();
            }
            
            clearInterval(breathingInterval);
            
            if (duration > 0) {
                let time = duration;
                countdown.textContent = time;
                breathingInterval = setInterval(() => {
                    time--;
                    countdown.textContent = time;
                    if (time <= 0) clearInterval(breathingInterval);
                }, 1000);
            } else {
                countdown.textContent = '—';
            }
        }

        function stopBreathing() {
            if (breathingInterval) clearInterval(breathingInterval);
            if (breathingTimeout) clearTimeout(breathingTimeout);
            if (timeInterval) clearInterval(timeInterval);
            
            const circle478 = document.getElementById('breathingCircle478');
            if (circle478) {
                circle478.classList.remove('inhale', 'hold', 'exhale');
                updateCircle(circle478, 'Готовность', 'начните когда готовы', 0);
            }
            
            const circle4812 = document.getElementById('breathingCircle4812');
            if (circle4812) {
                circle4812.classList.remove('inhale', 'hold', 'exhale');
                updateCircle(circle4812, 'Готовность', 'начните когда готовы', 0);
            }
            
            const start478 = document.getElementById('startBtn478');
            const stop478 = document.getElementById('stopBtn478');
            if (start478) start478.style.display = 'block';
            if (stop478) stop478.style.display = 'none';
            
            const start4812 = document.getElementById('startBtn4812');
            const stop4812 = document.getElementById('stopBtn4812');
            if (start4812) start4812.style.display = 'block';
            if (stop4812) stop4812.style.display = 'none';
            
            currentBreathingMode = null;
        }

        function initGrounding() {
            currentGroundingStep = 0;
            renderGroundingCard();
        }

        function renderGroundingCard() {
            const card = document.getElementById('groundingCard');
            const step = groundingSteps[currentGroundingStep];
            let content = '';
            
            if (step.type === 'intro') {
                content = `
                    <div class="grounding-card-content">
                        <div class="grounding-intro-title">${step.title}</div>
                        <div class="grounding-intro-subtitle">${step.subtitle.replace(/\n/g, '<br>')}</div>
                        <button class="start-grounding-button" onclick="nextGroundingStep()">Начать</button>
                    </div>
                `;
            } else if (step.type === 'outro') {
                content = `
                    <div class="grounding-card-content">
                        <div class="grounding-intro-title">${step.title}</div>
                        <div class="grounding-intro-subtitle">${step.subtitle.replace(/\n/g, '<br>')}</div>
                        <button class="start-grounding-button" onclick="initGrounding()">Начать заново</button>
                    </div>
                `;
            } else {
                const stepNum = currentGroundingStep;
                const totalSteps = groundingSteps.length - 2;
                content = `
                    <div class="grounding-card-content">
                        <div class="grounding-step-number">${step.number}</div>
                        <div class="grounding-step-title">${step.title}</div>
                        <div class="grounding-step-description">${step.description}</div>
                        <div class="grounding-step-example">${step.example}</div>
                    </div>
                    <div class="grounding-navigation">
                        <button class="grounding-nav-button" onclick="prevGroundingStep()" ${stepNum === 1 ? 'disabled' : ''}>←</button>
                        <div class="grounding-progress">${stepNum} / ${totalSteps}</div>
                        <button class="grounding-nav-button" onclick="nextGroundingStep()" ${stepNum === totalSteps ? 'disabled' : ''}>→</button>
                    </div>
                `;
            }
            
            card.innerHTML = content;
            
            if (!step.type && currentGroundingStep > 0 && currentGroundingStep < groundingSteps.length - 1) {
                triggerHaptic();
            }
        }

        function nextGroundingStep() {
            if (currentGroundingStep < groundingSteps.length - 1) {
                currentGroundingStep++;
                renderGroundingCard();
            }
        }

        function prevGroundingStep() {
            if (currentGroundingStep > 0) {
                currentGroundingStep--;
                renderGroundingCard();
            }
        }
        
        // Медитация
        function startMeditation(type, duration) {
            if (meditationInterval) clearInterval(meditationInterval);
            if (promptInterval) clearInterval(promptInterval);
            
            currentMeditationType = type;
            meditationTimeLeft = duration * 60;
            currentPromptIndex = 0;
            isPaused = false;
            
            const data = meditationData[type];
            document.getElementById('meditationTitle').textContent = data.title;
            document.getElementById('meditationPrompt').textContent = data.prompts[0];
            document.getElementById('meditationTimer').textContent = formatTime(meditationTimeLeft);
            
            showScreen('meditationScreen');
            
            meditationInterval = setInterval(() => {
                if (!isPaused) {
                    meditationTimeLeft--;
                    document.getElementById('meditationTimer').textContent = formatTime(meditationTimeLeft);
                    if (meditationTimeLeft <= 0) {
                        stopMeditation();
                        alert('Медитация завершена! 🙏');
                    }
                }
            }, 1000);
            
            const promptDelay = 30;
            let promptTime = promptDelay;
            
            promptInterval = setInterval(() => {
                if (!isPaused) {
                    promptTime--;
                    if (promptTime <= 0 && currentPromptIndex < data.prompts.length - 1) {
                        currentPromptIndex++;
                        document.getElementById('meditationPrompt').textContent = data.prompts[currentPromptIndex];
                        promptTime = promptDelay;
                        triggerHaptic();
                    }
                }
            }, 1000);
        }
        
        function togglePause() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            if (isPaused) {
                btn.textContent = 'ПРОДОЛЖИТЬ';
                btn.style.background = '#4CAF50';
            } else {
                btn.textContent = 'ПАУЗА';
                btn.style.background = '#FFA500';
            }
        }
        
        function stopMeditation() {
            if (meditationInterval) clearInterval(meditationInterval);
            if (promptInterval) clearInterval(promptInterval);
            isPaused = false;
            currentMeditationType = null;
            meditationInterval = null;
            promptInterval = null;
            
            const btn = document.getElementById('pauseBtn');
            if (btn) {
                btn.textContent = 'ПАУЗА';
                btn.style.background = '#FFA500';
            }
            
            const ms = document.getElementById('meditationScreen');
            if (ms && ms.classList.contains('active')) {
                showScreen('meditationMenu');
            }
        }
        
        // Релаксация
        function startRelaxation(type, duration) {
            if (relaxationInterval) clearInterval(relaxationInterval);
            if (relaxPromptInterval) clearInterval(relaxPromptInterval);
            
            currentRelaxationType = type;
            relaxationTimeLeft = duration * 60;
            currentRelaxPromptIndex = 0;
            isRelaxPaused = false;
            
            const data = relaxationData[type];
            document.getElementById('relaxationTitle').textContent = data.title;
            document.getElementById('relaxationPrompt').textContent = data.prompts[0];
            document.getElementById('relaxationTimer').textContent = formatTime(relaxationTimeLeft);
            
            showScreen('relaxationScreen');
            
            relaxationInterval = setInterval(() => {
                if (!isRelaxPaused) {
                    relaxationTimeLeft--;
                    document.getElementById('relaxationTimer').textContent = formatTime(relaxationTimeLeft);
                    if (relaxationTimeLeft <= 0) {
                        stopRelaxation();
                        alert('Релаксация завершена! 🌸');
                    }
                }
            }, 1000);
            
            const promptDelay = 30;
            let promptTime = promptDelay;
            
            relaxPromptInterval = setInterval(() => {
                if (!isRelaxPaused) {
                    promptTime--;
                    if (promptTime <= 0 && currentRelaxPromptIndex < data.prompts.length - 1) {
                        currentRelaxPromptIndex++;
                        document.getElementById('relaxationPrompt').textContent = data.prompts[currentRelaxPromptIndex];
                        promptTime = promptDelay;
                        triggerHaptic();
                    }
                }
            }, 1000);
        }
        
        function togglePauseRelax() {
            isRelaxPaused = !isRelaxPaused;
            const btn = document.getElementById('pauseBtnRelax');
            if (isRelaxPaused) {
                btn.textContent = 'ПРОДОЛЖИТЬ';
                btn.style.background = '#4CAF50';
            } else {
                btn.textContent = 'ПАУЗА';
                btn.style.background = '#FFA500';
            }
        }
        
        function stopRelaxation() {
            if (relaxationInterval) clearInterval(relaxationInterval);
            if (relaxPromptInterval) clearInterval(relaxPromptInterval);
            isRelaxPaused = false;
            currentRelaxationType = null;
            relaxationInterval = null;
            relaxPromptInterval = null;
            
            const btn = document.getElementById('pauseBtnRelax');
            if (btn) {
                btn.textContent = 'ПАУЗА';
                btn.style.background = '#FFA500';
            }
            
            const rs = document.getElementById('relaxationScreen');
            if (rs && rs.classList.contains('active')) {
                showScreen('relaxationMenu');
            }
        }
    </script>
</body>
</html>